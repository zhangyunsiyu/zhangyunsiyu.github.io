<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《微信小程序实战笔记》 | zhangyun&#39;s blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="manifest" href="/photo.jpg">
    <link rel="apple-touch-icon" href="/photo.jpg">
    <meta name="description" content="张赟的个人博客">
    <link rel="preload" href="/assets/css/0.styles.3ef2f377.css" as="style"><link rel="preload" href="/assets/js/app.ee37e791.js" as="script"><link rel="preload" href="/assets/js/2.0887c104.js" as="script"><link rel="preload" href="/assets/js/4.39caabe0.js" as="script"><link rel="prefetch" href="/assets/js/10.9180b203.js"><link rel="prefetch" href="/assets/js/11.c97d0fac.js"><link rel="prefetch" href="/assets/js/12.941fee2c.js"><link rel="prefetch" href="/assets/js/13.b0462ff3.js"><link rel="prefetch" href="/assets/js/14.c4db9811.js"><link rel="prefetch" href="/assets/js/15.f3d3ac23.js"><link rel="prefetch" href="/assets/js/16.3c300b03.js"><link rel="prefetch" href="/assets/js/17.8573adce.js"><link rel="prefetch" href="/assets/js/18.d7656d21.js"><link rel="prefetch" href="/assets/js/19.d136fa1e.js"><link rel="prefetch" href="/assets/js/20.6fc5337e.js"><link rel="prefetch" href="/assets/js/21.02308494.js"><link rel="prefetch" href="/assets/js/22.8192e86f.js"><link rel="prefetch" href="/assets/js/23.c635318c.js"><link rel="prefetch" href="/assets/js/24.d4826e2d.js"><link rel="prefetch" href="/assets/js/25.52e59918.js"><link rel="prefetch" href="/assets/js/3.5e865b63.js"><link rel="prefetch" href="/assets/js/5.aeab712c.js"><link rel="prefetch" href="/assets/js/6.3b17408d.js"><link rel="prefetch" href="/assets/js/7.dc4d4a75.js"><link rel="prefetch" href="/assets/js/8.930e5d85.js"><link rel="prefetch" href="/assets/js/9.c130f018.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3ef2f377.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">zhangyun's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端总结" class="dropdown-title"><span class="title">前端总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/WEB/" class="nav-link">
  WEB基础
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/JavaScript/" class="nav-link">
  JavaScript笔记
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/Vue/" class="nav-link">
  Vue笔记
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/React/" class="nav-link">
  React笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小程序总结" class="dropdown-title"><span class="title">小程序总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/miniApp/wechatApp/" class="nav-link router-link-active">
  微信小程序
</a></li><li class="dropdown-item"><!----> <a href="/miniApp/alipayApp/" class="nav-link">
  支付宝小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务端总结" class="dropdown-title"><span class="title">服务端总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/serveEnd/NodeJs/" class="nav-link">
  NodeJs
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="混合app" class="dropdown-title"><span class="title">混合app</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/app/cordova/" class="nav-link">
  cordova
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="感动常在" class="dropdown-title"><span class="title">感动常在</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mySpace/essay/" class="nav-link">
  读书笔记
</a></li><li class="dropdown-item"><!----> <a href="/mySpace/photo/" class="nav-link">
  摄影随笔
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端总结" class="dropdown-title"><span class="title">前端总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/WEB/" class="nav-link">
  WEB基础
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/JavaScript/" class="nav-link">
  JavaScript笔记
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/Vue/" class="nav-link">
  Vue笔记
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/React/" class="nav-link">
  React笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小程序总结" class="dropdown-title"><span class="title">小程序总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/miniApp/wechatApp/" class="nav-link router-link-active">
  微信小程序
</a></li><li class="dropdown-item"><!----> <a href="/miniApp/alipayApp/" class="nav-link">
  支付宝小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务端总结" class="dropdown-title"><span class="title">服务端总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/serveEnd/NodeJs/" class="nav-link">
  NodeJs
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="混合app" class="dropdown-title"><span class="title">混合app</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/app/cordova/" class="nav-link">
  cordova
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="感动常在" class="dropdown-title"><span class="title">感动常在</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mySpace/essay/" class="nav-link">
  读书笔记
</a></li><li class="dropdown-item"><!----> <a href="/mySpace/photo/" class="nav-link">
  摄影随笔
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>微信小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miniApp/wechatApp/" class="sidebar-link">写在前面</a></li><li><a href="/miniApp/wechatApp/note.html" class="active sidebar-link">《微信小程序实战笔记》</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miniApp/wechatApp/note.html#微信小程序实现地图功能" class="sidebar-link">微信小程序实现地图功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/miniApp/wechatApp/note.html#地图导航" class="sidebar-link">地图导航</a></li><li class="sidebar-sub-header"><a href="/miniApp/wechatApp/note.html#电子围栏" class="sidebar-link">电子围栏</a></li></ul></li><li class="sidebar-sub-header"><a href="/miniApp/wechatApp/note.html#小程序蓝牙交互" class="sidebar-link">小程序蓝牙交互</a></li></ul></li><li><a href="/miniApp/wechatApp/wechatCloud.html" class="sidebar-link">《小程序云开发》</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="微信小程序实现地图功能"><a href="#微信小程序实现地图功能" class="header-anchor">#</a> 微信小程序实现地图功能</h2> <figure class="half"><img src="/assets/img/1.69e8bb52.png" width="300"> <img src="/assets/img/2.addc3327.jpg" width="300"></figure> <p>话不多说 , 直接code</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>map<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>myMap<span class="token punctuation">'</span></span> 
      <span class="token attr-name">longitude</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{longitude}}<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">latitude</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{latitude}}<span class="token punctuation">&quot;</span></span> 
      <span class="token attr-name">scale</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{scale}}<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">show-location</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> 
      <span class="token attr-name">markers</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{markers}}<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">polyline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{polyline}}<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">bindmarkertap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bindMakertap<span class="token punctuation">&quot;</span></span>  
      <span class="token attr-name">bindregionchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>regionChange<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="地图导航"><a href="#地图导航" class="header-anchor">#</a> 地图导航</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引用腾讯地图sdk</span>
<span class="token keyword">var</span> QQMapWX <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/qqmap-wx-jssdk.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    longitude<span class="token punctuation">,</span>
    latitude<span class="token punctuation">,</span>
    scale<span class="token punctuation">,</span>
    markers<span class="token punctuation">,</span>
    polyline<span class="token punctuation">,</span>
    currentMarkerIndex<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    allVehiclesData<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        vcId<span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
        parkingLng<span class="token operator">:</span> <span class="token string">'121.415008'</span><span class="token punctuation">,</span>
        parkingLat<span class="token operator">:</span> <span class="token string">'31.172685'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * 初始化地图
   */</span>
  <span class="token function-variable function">initMap</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    qqmapsdk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QQMapWX</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      key<span class="token operator">:</span> constant<span class="token punctuation">.</span>tencentAk  <span class="token comment">// 腾讯地图开发者key</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 绘制图例标签</span>
    that<span class="token punctuation">.</span><span class="token function">createMarker</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allVehiclesData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 拖动地图回调
   */</span>
  <span class="token function-variable function">regionChange</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token comment">// 改变中心点位置  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 此处进行对应操作</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">/**
   * 创建marker
   */</span>
  <span class="token function-variable function">createMarker</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dataList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> currentMarker <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> markerList <span class="token operator">=</span> dataList<span class="token punctuation">;</span>
    consoleUtil<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>markerList<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> markerList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> marker <span class="token operator">=</span> markerList<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      marker<span class="token punctuation">.</span>id <span class="token operator">=</span> marker<span class="token punctuation">.</span>vcId<span class="token punctuation">;</span>
      marker<span class="token punctuation">.</span>latitude <span class="token operator">=</span> marker<span class="token punctuation">.</span>parkingLat<span class="token punctuation">;</span>
      marker<span class="token punctuation">.</span>longitude <span class="token operator">=</span> marker<span class="token punctuation">.</span>parkingLng<span class="token punctuation">;</span>
      marker<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
      marker<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
      marker<span class="token punctuation">.</span>iconPath <span class="token operator">=</span> <span class="token string">'../../assets/images/map_point01.png'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    currentMarker <span class="token operator">=</span> currentMarker<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>markerList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    consoleUtil<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>currentMarker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      markers<span class="token operator">:</span> currentMarker
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 点击marker进行导航
   */</span>
  <span class="token function-variable function">bindMakertap</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> option <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allVehiclesData<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>vcId <span class="token operator">==</span> e<span class="token punctuation">.</span>markerId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        option <span class="token operator">=</span> index
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> currentMarker <span class="token operator">=</span> <span class="token punctuation">{</span>
      longitude<span class="token operator">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allVehiclesData<span class="token punctuation">[</span>option<span class="token punctuation">]</span><span class="token punctuation">.</span>parkingLng<span class="token punctuation">,</span>
      latitude<span class="token operator">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allVehiclesData<span class="token punctuation">[</span>option<span class="token punctuation">]</span><span class="token punctuation">.</span>parkingLat
    <span class="token punctuation">}</span>
    <span class="token comment">//设置当前点击的车辆id</span>
    that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      currentMarkerIndex<span class="token operator">:</span> option
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    that<span class="token punctuation">.</span><span class="token function">createdPolyline</span><span class="token punctuation">(</span>currentMarker<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 绘制当前导航路径
   */</span>
  <span class="token function">createdPolyline</span><span class="token punctuation">(</span><span class="token parameter">currentMarker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 先获取当前最新位置</span>
    <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// 每次绘制之前保证当前位置准确</span>
    that<span class="token punctuation">.</span><span class="token function">requestLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">var</span> suffix <span class="token operator">=</span> <span class="token string">''</span>
    data<span class="token punctuation">.</span>from <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>latitude <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>longitude
    data<span class="token punctuation">.</span>to <span class="token operator">=</span> currentMarker<span class="token punctuation">.</span>latitude <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> currentMarker<span class="token punctuation">.</span>longitude
    data<span class="token punctuation">.</span>key <span class="token operator">=</span> constant<span class="token punctuation">.</span>tencentAk
    <span class="token comment">// 拼接请求数据</span>
    suffix <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取步行路线坐标</span>
    api<span class="token punctuation">.</span><span class="token function">directionWalking</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 坐标点</span>
      <span class="token keyword">var</span> coors <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>routes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>polyline
      <span class="token comment">// 距离</span>
      <span class="token keyword">var</span> distance <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>routes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>distance
      <span class="token comment">// 时间</span>
      <span class="token keyword">var</span> duration <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>routes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>duration
      <span class="token comment">// 处理后的坐标点</span>
      <span class="token keyword">var</span> points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token comment">// 新的marker数据</span>
      <span class="token keyword">var</span> currentMarkerList <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markers
      <span class="token keyword">var</span> currentMarker <span class="token operator">=</span> currentMarkerList<span class="token punctuation">[</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>currentMarkerIndex<span class="token punctuation">]</span>
      <span class="token comment">// 为当前marker添加导航标注</span>
      currentMarker<span class="token punctuation">.</span>callout <span class="token operator">=</span> <span class="token punctuation">{</span>
        content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">步行 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>duration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">分钟 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">米</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token string">&quot;#ffffff&quot;</span><span class="token punctuation">,</span>
        fontSize<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        borderRadius<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        bgColor<span class="token operator">:</span> <span class="token string">&quot;#68b6f4&quot;</span><span class="token punctuation">,</span>
        padding<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        display<span class="token operator">:</span> <span class="token string">&quot;ALWAYS&quot;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 格式化原始导航坐标</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> coors<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        coors<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> coors<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> coors<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1000000</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> coors<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        points<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          latitude<span class="token operator">:</span> coors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
          longitude<span class="token operator">:</span> coors<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 渲染路径</span>
      that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        polyline<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          points<span class="token operator">:</span> points<span class="token punctuation">,</span>
          color<span class="token operator">:</span> <span class="token string">&quot;#68b6f4&quot;</span><span class="token punctuation">,</span>
          width<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
          dottedLine<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          arrowLine<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        markers<span class="token operator">:</span> currentMarkerList
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="电子围栏"><a href="#电子围栏" class="header-anchor">#</a> 电子围栏</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 围栏坐标 (模拟的数据)</span>
<span class="token keyword">var</span> APoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  lat<span class="token operator">:</span> <span class="token number">31.172685</span><span class="token punctuation">,</span>
  lng<span class="token operator">:</span> <span class="token number">121.415008</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    lat<span class="token operator">:</span> <span class="token number">31.173167</span><span class="token punctuation">,</span>
    lng<span class="token operator">:</span> <span class="token number">121.416559</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  lat<span class="token operator">:</span> <span class="token number">31.172231</span><span class="token punctuation">,</span>
  lng<span class="token operator">:</span> <span class="token number">121.415100</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  lat<span class="token operator">:</span> <span class="token number">31.172488</span><span class="token punctuation">,</span>
  lng<span class="token operator">:</span> <span class="token number">121.416317</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">isPtInPoly</span><span class="token punctuation">(</span><span class="token parameter">ALon<span class="token punctuation">,</span> ALat</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ALon<span class="token punctuation">,</span> ALat<span class="token punctuation">)</span>
  <span class="token keyword">var</span> iSum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    iCount<span class="token punctuation">;</span>
  <span class="token keyword">var</span> dLon1<span class="token punctuation">,</span> dLon2<span class="token punctuation">,</span> dLat1<span class="token punctuation">,</span> dLat2<span class="token punctuation">,</span> dLon<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>APoints<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  iCount <span class="token operator">=</span> APoints<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> iCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> iCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dLon1 <span class="token operator">=</span> APoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lng<span class="token punctuation">;</span>
      dLat1 <span class="token operator">=</span> APoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lat<span class="token punctuation">;</span>
      dLon2 <span class="token operator">=</span> APoints<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lng<span class="token punctuation">;</span>
      dLat2 <span class="token operator">=</span> APoints<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lat<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      dLon1 <span class="token operator">=</span> APoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lng<span class="token punctuation">;</span>
      dLat1 <span class="token operator">=</span> APoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lat<span class="token punctuation">;</span>
      dLon2 <span class="token operator">=</span> APoints<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lng<span class="token punctuation">;</span>
      dLat2 <span class="token operator">=</span> APoints<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lat<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//以下语句判断X点是否在边的两端点的水平平行线之间，在则可能有交点，开始判断交点是否在左射线上</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ALat <span class="token operator">&gt;=</span> dLat1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ALat <span class="token operator">&lt;</span> dLat2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ALat <span class="token operator">&gt;=</span> dLat2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ALat <span class="token operator">&lt;</span> dLat1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>dLat1 <span class="token operator">-</span> dLat2<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//得到 X点向左射线与边的交点的x坐标：</span>
        dLon <span class="token operator">=</span> dLon1 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dLon1 <span class="token operator">-</span> dLon2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>dLat1 <span class="token operator">-</span> ALat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>dLat1 <span class="token operator">-</span> dLat2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dLon <span class="token operator">&lt;</span> ALon<span class="token punctuation">)</span>
          iSum<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>iSum <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  isPtInPoly<span class="token operator">:</span> isPtInPoly
<span class="token punctuation">}</span>
</code></pre></div><h2 id="小程序蓝牙交互"><a href="#小程序蓝牙交互" class="header-anchor">#</a> 小程序蓝牙交互</h2> <p>一般产品流程图
</p><figure class="half"><img src="/assets/img/蓝牙连接流程图.6b1f7d90.jpg" width="500" height="1200"></figure><p></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/miniApp/wechatApp/" class="prev router-link-active">
        写在前面
      </a></span> <span class="next"><a href="/miniApp/wechatApp/wechatCloud.html">
        《小程序云开发》
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ee37e791.js" defer></script><script src="/assets/js/2.0887c104.js" defer></script><script src="/assets/js/4.39caabe0.js" defer></script>
  </body>
</html>
